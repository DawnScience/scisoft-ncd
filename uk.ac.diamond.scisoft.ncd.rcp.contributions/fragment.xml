<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<fragment>
   <extension
         point="org.eclipse.ui.commands">
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableAverage"
            name="Average">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.average.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableBackgroundSubtraction"
            name="Background Subtraction">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.backgroundsubtraction.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableDetectorResponse"
            name="Detector Response">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.detectorresponse.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableInvariant"
            name="Invariant">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.invariant.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableNormalisation"
            name="Normalisation">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.normalisation.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableSectorIntegration"
            name="Sector Integration">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.sectorintegration.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableWaxsDataReduction"
            name="WAXS Data Reduction">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.waxsdatareduction.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableSaxsDataReduction"
            name="SAXS Data Reduction">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.saxsdatareduction.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.enableMask"
            name="Mask">
         <state
               class="org.eclipse.jface.commands.ToggleState"
               id="uk.ac.diamond.scisoft.ncd.rcp.mask.state">
         </state>
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.process"
            name="Run Data Reduction">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.setBackgroundSubtractionFile"
            name="Select Background Subtraction File">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.setDetectorResponseFile"
            name="Select Detector Response File">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.setSectorIntegration"
            name="Select Sector Integration File">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.setDetectorMask"
            name="Select Detector Mask File">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.readQAxisCalibration"
            name="Load QAxis Calibration">
      </command>
      <command
            id="uk.ac.diamond.scisoft.ncd.rcp.readDetectorInfo"
            name="Read Detector Information">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.perspectives">
      <perspective
            class="uk.ac.diamond.scisoft.ncd.rcp.NcdPerspective"
            icon="icons/ncd_icon.png"
            id="uk.ac.diamond.scisoft.ncd.rcp.ncdperspective"
            name="NCD Data Reduction">
      </perspective>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="false"
            locationURI="popup:org.eclipse.ui.navigator.ProjectExplorer#PopupMenu">
         <menu
               label="NCD">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="activeWorkbenchWindow.activePerspective">
                  <equals
                        value="uk.ac.diamond.scisoft.ncd.rcp.ncdperspective">
                  </equals>
               </with>
            </visibleWhen>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.readDetectorInfo"
                  label="Read Detector Information"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setBackgroundSubtractionFile"
                  label="Set as Background Subtraction File"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorResponseFile"
                  label="Set as Detector Response File"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setSectorIntegration"
                  label="Load Calibration Image"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorMask"
                  label="Load Detector Mask"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.readQAxisCalibration"
                  label="Load QAxis Calibration"
                  style="push">
            </command>
            <separator
                  name="uk.ac.diamond.scisoft.ncd.rcp.separator1"
                  visible="true">
            </separator>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.process"
                  label="Run Data Reduction"
                  style="push">
            </command>
         </menu>
      </menuContribution>
      <menuContribution
            allPopups="false"
            locationURI="popup:uk.ac.diamond.sda.navigator.views.FileView">
         <menu
               label="NCD">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="activeWorkbenchWindow.activePerspective">
                  <equals
                        value="uk.ac.diamond.scisoft.ncd.rcp.ncdperspective">
                  </equals>
               </with>
            </visibleWhen>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.readDetectorInfo"
                  label="Read Detector Information"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setBackgroundSubtractionFile"
                  label="Set as Background Subtraction File"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorResponseFile"
                  label="Set as Detector Response File"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setSectorIntegration"
                  label="Load Calibration Image"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorMask"
                  label="Load Detector Mask"
                  style="push">
            </command>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.readQAxisCalibration"
                  label="Load QAxis Calibration"
                  style="push">
            </command>
            <separator
                  name="uk.ac.diamond.scisoft.ncd.rcp.separator1"
                  visible="true">
            </separator>
            <command
                  commandId="uk.ac.diamond.scisoft.ncd.rcp.process"
                  label="Run Data Reduction"
                  style="push">
            </command>
         </menu>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.services">
      <sourceProvider
            provider="uk.ac.diamond.scisoft.ncd.rcp.NcdProcessingSourceProvider">
         <variable
               name="uk.ac.diamond.scisoft.ncd.rcp.enableBackgroundSubtraction"
               priorityLevel="workbench">
         </variable>
         <variable
               name="uk.ac.diamond.scisoft.ncd.rcp.enableDetectorResponse"
               priorityLevel="workbench">
         </variable>
         <variable
               name="uk.ac.diamond.scisoft.ncd.rcp.enableSectorIntegration"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DataReductionHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.process">
         <enabledWhen>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.AverageHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableAverage">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.BackgroundSubtractionHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableBackgroundSubtraction">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DetectorResponseHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableDetectorResponse">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.InvariantHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableInvariant">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.NormalisationHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableNormalisation">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.SectorIntegrationHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableSectorIntegration">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.WaxsDataReductionHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableWaxsDataReduction">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.SaxsDataReductionHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableSaxsDataReduction">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DetectorMaskHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.enableMask">
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.SectorIntegrationFileHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.setSectorIntegration">
         <enabledWhen>
            <and>
                  <with
                        variable="uk.ac.diamond.scisoft.ncd.rcp.enableSectorIntegration">
                     <equals
                           value="true">
                     </equals>
                  </with>
               <with
                  variable="activeMenuSelection">
               <count
                     value="1">
               </count>
               </with>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DetectorMaskFileHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorMask">
         <enabledWhen>
            <and>
               <with
                  variable="activeMenuSelection">
               <count
                     value="1">
               </count>
               </with>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.BackgroundSubtractionFileHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.setBackgroundSubtractionFile">
         <enabledWhen>
            <and>
                  <with
                        variable="uk.ac.diamond.scisoft.ncd.rcp.enableBackgroundSubtraction">
                     <equals
                           value="true">
                     </equals>
                  </with>
               <with
                  variable="activeMenuSelection">
               <count
                     value="1">
               </count>
               </with>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DetectorResponseFileHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.setDetectorResponseFile">
         <enabledWhen>
            <and>
                  <with
                        variable="uk.ac.diamond.scisoft.ncd.rcp.enableDetectorResponse">
                     <equals
                           value="true">
                     </equals>
                  </with>
               <with
                  variable="activeMenuSelection">
               <count
                     value="1">
               </count>
               </with>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.DetectorInformationHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.readDetectorInfo">
         <enabledWhen>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
         </enabledWhen>
      </handler>
      <handler
            class="uk.ac.diamond.scisoft.ncd.rcp.handlers.QAxisFileHandler"
            commandId="uk.ac.diamond.scisoft.ncd.rcp.readQAxisCalibration">
         <enabledWhen>
            <and>
               <with
                  variable="activeMenuSelection">
               <count
                     value="1">
               </count>
               </with>
               <or>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="org.eclipse.core.resources.IFile">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               <with
                  variable="activeMenuSelection">
                  <iterate>
                     <and>
                        <instanceof
                              value="java.io.File">
                        </instanceof>
                     </and>
                  </iterate>
               </with>
               </or>
            </and>
         </enabledWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.views">
      <view
            category="uk.ac.diamond.scisoft.analysis.rcp"
            class="uk.ac.diamond.scisoft.ncd.rcp.views.NcdDataReductionParameters"
            id="uk.ac.diamond.scisoft.ncd.rcp.views.NcdDataReductionParameters"
            name="NCD Data Reduction Parameters"
            restorable="true">
      </view>
      <view
            category="uk.ac.diamond.scisoft.analysis.rcp"
            class="uk.ac.diamond.scisoft.ncd.rcp.views.SaxsQAxisCalibration"
            id="uk.ac.diamond.scisoft.ncd.rcp.views.SaxsQAxisCalibration"
            name="Saxs Q-axis Calibration"
            restorable="true">
      </view>
      <!--
      <view
            category="uk.ac.diamond.scisoft.analysis.rcp"
            class="uk.ac.diamond.scisoft.ncd.rcp.views.WaxsQAxisCalibration"
            id="uk.ac.diamond.scisoft.ncd.rcp.views.WaxsQAxisCalibration"
            name="Waxs Q-axis Calibration"
            restorable="true">
      </view>
      -->
   </extension>
   <extension
         point="org.eclipse.ui.activities">
      <activity
            id="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            name="Forbidden NCD Views">
      </activity>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.common.rcp/uk.ac.gda.client.general.category">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.NcdDetectorPerspective">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.SetupPerspective">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.GridScanPerspective">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.SaxsPerspective">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.WaxsPerspective">
      </activityPatternBinding>
      <activityPatternBinding
            activityId="uk.ac.diamond.scisoft.ncd.rcp.forbiddenncdviews"
            pattern="uk.ac.gda.client.ncd/gda.rcp.ncd.perspectives.DataPerspective">
      </activityPatternBinding>
   </extension>
   <extension
         point="uk.ac.diamond.scisoft.introRegister">
      <introPageRegister
            class="uk.ac.diamond.scisoft.ncd.rcp.NcdPerspectiveLaunch"
            description="Opens the perspective for non-crystalline diffraction data processing"
            icon="icons/ncd_intro.png"
            id="uk.ac.diamond.scisoft.ncd.rcp.intro.ncdperspective"
            name="(Pre-release) NCD Data Reduction">
      </introPageRegister>
   </extension>
   <extension
         point="org.eclipse.ui.cheatsheets.cheatSheetContent">
      <category
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            name="NCD Data Reduction Tutorials">
      </category>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/ImportData.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.importdata"
            name="Importing data">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/DetectorInformation.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.detectorinfo"
            name="Loading detector information">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/DataReduction.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.datareduction"
            name="Running NCD data reduction">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/Masking.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.masking"
            name="Using detector mask">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/SAXScalibration.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.saxscalibration"
            name="Calibrating SAXS detector">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/RestoringData.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.restoredata"
            name="Restoring Detector Mask and Q-axis Calibration Data">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="false"
            contentFile="cheatsheets/SliceAverage.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.sliceaverage"
            name="Advanced Slicing and Averaging Techniques">
      </cheatsheet>
      <cheatsheet
            category="uk.ac.diamond.scisoft.ncd.rcp.contributions.ncdtutorial"
            composite="true"
            contentFile="cheatsheets/NCDTutorial.xml"
            id="uk.ac.diamond.scisoft.ncd.rcp.contributions.cheatsheet.ncdtutorial"
            name="NCD Data Reduction Tutorials">
      </cheatsheet>
   </extension>

</fragment>
